<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××•×–×™××•×Ÿ ×”×¡×™×¤×•×¨×™× - ×ª×œ ××‘×™×‘</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            direction: rtl;
            padding-bottom: 100px; /* ××§×•× ×œ×›×¤×ª×•×¨×™× ×”×¦×¤×™× */
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 800px;
            width: 90%;
            backdrop-filter: blur(10px);
            margin: 20px auto; /* ××¨×•×•×— ×™×¤×” ××œ××¢×œ×” ×•××œ××˜×” */
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .search-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .search-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 15px;
            border: 2px solid #bdc3c7;
            border-radius: 25px;
            font-size: 16px;
            direction: rtl;
            background: white;
        }

        .search-input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }

        .random-story-btn {
            padding: 12px 25px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .random-story-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .stories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .story-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .story-card:hover {
            transform: translateY(-3px);
        }

        .story-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .story-description {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .story-duration {
            color: #3498db;
            font-size: 0.8rem;
            margin-bottom: 15px;
        }

        .play-btn {
            width: 100%;
            padding: 12px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .play-btn:hover {
            background: #219a52;
        }

        .qr-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            display: none;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            background: white;
            margin: 20px auto;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #666;
        }

        .voice-assistant {
            display: none;
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 15px;
        }

        .voice-btn {
            padding: 15px 30px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .voice-btn:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        .admin-panel {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: #2c3e50;
            color: white;
            border-radius: 15px;
        }

        .admin-section {
            margin-bottom: 30px;
        }

        .admin-section h3 {
            margin-bottom: 15px;
            color: #3498db;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            font-size: 14px;
            direction: rtl;
        }

        .admin-btn {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            margin-bottom: 10px;
        }

        .admin-btn:hover {
            background: #2980b9;
        }

        .admin-btn.danger {
            background: #e74c3c;
        }

        .admin-btn.danger:hover {
            background: #c0392b;
        }

        .story-list, .user-list {
            background: white;
            color: #2c3e50;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .story-item, .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ecf0f1;
        }

        .story-item:last-child, .user-item:last-child {
            border-bottom: none;
        }

        .bottom-nav {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 15px;
            background: #34495e;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #2c3e50;
            transform: translateY(-2px);
        }

        .audio-player {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 20px;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
            border-top: 3px solid #3498db;
        }

        .player-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .control-btn {
            padding: 10px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
        }

        .progress-bar {
            flex: 1;
            margin: 0 20px;
        }

        .admin-login {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .login-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            direction: rtl;
        }

        .login-form h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .login-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            direction: rtl;
        }

        .login-input:focus {
            border-color: #3498db;
            outline: none;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
        }

        .login-btn:hover {
            background: #2980b9;
        }

        .login-btn.cancel {
            background: #95a5a6;
        }

        .login-btn.cancel:hover {
            background: #7f8c8d;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .search-controls {
                flex-direction: column;
            }
            
            .search-input {
                min-width: auto;
                width: 100%;
            }
            
            .random-story-btn {
                width: 100%;
            }
            
            .stories-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ ××•×–×™××•×Ÿ ×”×¡×™×¤×•×¨×™×</h1>
            <p>×’×œ×• ××ª ×”×¡×™×¤×•×¨×™× ×”××¨×ª×§×™× ×©×œ ×ª×œ ××‘×™×‘</p>
        </div>

        <!-- ×—×™×¤×•×© ×•×¡×™×¤×•×¨ ×¨× ×“×•××œ×™ -->
        <div class="search-section">
            <div class="search-controls">
                <input type="text" id="searchInput" placeholder="×—×¤×©×• ×¡×™×¤×•×¨ ×œ×¤×™ × ×•×©× ××• ××™×œ×•×ª ××¤×ª×—..." class="search-input">
                <button class="random-story-btn" onclick="playRandomStory()">×ª×©××™×¢ ×œ×™ ×¡×™×¤×•×¨ ×©×‘×—×¨×ª</button>
            </div>
        </div>

        <!-- ×¨×©×™××ª ×¡×™×¤×•×¨×™× -->
        <div class="stories-grid" id="storiesGrid">
            <!-- ×”×¡×™×¤×•×¨×™× ×™×•×¦×’×• ×›××Ÿ ×“×™× ××™×ª -->
        </div>

        <!-- × ×’×Ÿ ××•×“×™×• -->
        <div class="audio-player" id="audioPlayer">
            <div class="player-controls">
                <button class="control-btn" onclick="togglePlay()" id="playPauseBtn">â¯ï¸</button>
                <audio id="realAudioPlayer" controls style="flex: 1; margin: 0 15px; display: none;" volume="1.0"></audio>
                <div class="progress-bar" id="simulationProgress" style="flex: 1; margin: 0 15px;">
                    <input type="range" id="progressBar" min="0" max="100" value="0" style="width: 100%;">
                </div>
                <div class="volume-control" style="display: flex; align-items: center; gap: 5px;">
                    <span style="font-size: 0.8rem;">ğŸ”Š</span>
                    <input type="range" id="volumeControl" min="0" max="100" value="100" style="width: 80px;" onchange="updateVolume()">
                </div>
                <button class="control-btn" onclick="testAudio()" id="testBtn" style="background: #f39c12;" title="×‘×“×™×§×ª ××•×“×™×•">ğŸ”</button>
                <button class="control-btn" onclick="closePlayer()">âœ–ï¸</button>
            </div>
            <div style="text-align: center; margin-top: 10px;">
                <span id="currentStoryTitle">×©× ×”×¡×™×¤×•×¨</span>
                <div id="audioStatus" style="font-size: 0.8rem; color: #7f8c8d; margin-top: 5px;"></div>
                <div id="audioDebug" style="font-size: 0.7rem; color: #95a5a6; margin-top: 3px;"></div>
            </div>
        </div>

        <!-- ×¤×× ×œ × ×™×”×•×œ -->
        <div class="admin-panel" id="adminPanel">
            <h2>ğŸ”§ ×¤×× ×œ × ×™×”×•×œ</h2>
            
            <!-- × ×™×”×•×œ ×¡×™×¤×•×¨×™× -->
            <div class="admin-section">
                <h3>ğŸ“š × ×™×”×•×œ ×¡×™×¤×•×¨×™×</h3>
                
                <div style="background: #3498db; color: white; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9rem;">
                    <strong>ğŸ’¡ ×”×•×¨××•×ª ×œ×”×¢×œ××ª ××•×“×™×•:</strong><br>
                    1. ××œ××• ××ª ×›×œ ×”×©×“×•×ª<br>
                    2. ×‘×—×¨×• ×§×•×‘×¥ MP3 ××™×›×•×ª×™ (×¢×“ 10MB)<br>
                    3. ×”××ª×™× ×• ×œ×”×•×“×¢×ª ××™×©×•×¨<br>
                    4. ×× ×™×© ×‘×¢×™×”, ×œ×—×¦×• ×¢×œ ğŸ” ×œ×™×“ ×”×¡×™×¤×•×¨ ×œ×“×™×‘××’
                </div>
                
                <div class="form-group">
                    <label>×©× ×”×¡×™×¤×•×¨:</label>
                    <input type="text" id="storyTitle" placeholder="×”×›× ×™×¡×• ×©× ×¡×™×¤×•×¨">
                </div>
                <div class="form-group">
                    <label>×ª×™××•×¨:</label>
                    <textarea id="storyDescription" placeholder="×ª×™××•×¨ ×§×¦×¨ ×©×œ ×”×¡×™×¤×•×¨" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>××©×š (×“×§×•×ª):</label>
                    <input type="number" id="storyDuration" placeholder="5" min="1">
                </div>
                <div class="form-group">
                    <label>×©×¤×”:</label>
                    <select id="storyLanguage">
                        <option value="he">×¢×‘×¨×™×ª</option>
                        <option value="en">English</option>
                        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>×§×•×‘×¥ ××•×“×™×• (××•×¤×¦×™×•× ×œ×™):</label>
                    <input type="file" id="storyFile" accept="audio/*">
                    <small style="color: #7f8c8d; display: block; margin-top: 5px;">
                        ğŸ’¡ ×”×§×•×‘×¥ ×™×™×©××¨ ×‘×ª×•×š ×”××ª×¨ ×•×™×ª× ×’×Ÿ ×™×©×™×¨×•×ª<br>
                        ğŸµ ×¤×•×¨××˜×™× × ×ª××›×™×: MP3, WAV, OGG, M4A<br>
                        âš ï¸ ×× ××™×Ÿ ×¡××•× ×“, ×‘×“×§×• ×©×¢×•×¦××ª ×”×§×•×œ ×‘××—×©×‘ ××§×¡×™××œ×™×ª
                    </small>
                </div>
                <button class="admin-btn" onclick="addStory()">â• ×”×•×¡×£ ×¡×™×¤×•×¨</button>
                
                <div class="story-list" id="storyList">
                    <!-- ×¨×©×™××ª ×”×¡×™×¤×•×¨×™× ×ª×•×¦×’ ×›××Ÿ -->
                </div>
            </div>

            <!-- × ×™×”×•×œ ××©×ª××©×™× -->
            <div class="admin-section">
                <h3>ğŸ‘¥ × ×™×”×•×œ ××©×ª××©×™×</h3>
                <div class="form-group">
                    <label>×©× ××©×ª××©:</label>
                    <input type="text" id="userName" placeholder="×”×›× ×™×¡×• ×©×">
                </div>
                <div class="form-group">
                    <label>××¡×¤×¨ ×˜×œ×¤×•×Ÿ:</label>
                    <input type="tel" id="userPhone" placeholder="05XXXXXXXX">
                </div>
                <div class="form-group">
                    <label>×©×¤×” ××•×¢×“×¤×ª:</label>
                    <select id="userLanguage">
                        <option value="he">×¢×‘×¨×™×ª</option>
                        <option value="en">English</option>
                        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                        <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                        <option value="am">áŠ áˆ›áˆ­áŠ›</option>
                    </select>
                </div>
                <button class="admin-btn" onclick="addUser()">â• ×”×•×¡×£ ××©×ª××©</button>
                <button class="admin-btn" onclick="exportUsers()">ğŸ“¤ ×™×™×¦× ×¨×©×™××”</button>
                
                <div class="user-list" id="userList">
                    <!-- ×¨×©×™××ª ×”××©×ª××©×™× ×ª×•×¦×’ ×›××Ÿ -->
                </div>
            </div>

            <!-- ×¡×˜×˜×™×¡×˜×™×§×•×ª -->
            <div class="admin-section">
                <h3>ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div style="background: #3498db; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2rem;" id="totalStories">0</div>
                        <div>×¡×™×¤×•×¨×™×</div>
                    </div>
                    <div style="background: #27ae60; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2rem;" id="totalUsers">0</div>
                        <div>××©×ª××©×™×</div>
                    </div>
                    <div style="background: #e74c3c; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2rem;" id="totalPlays">0</div>
                        <div>×”××–× ×•×ª</div>
                    </div>
                    <div style="background: #9b59b6; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.2rem;" id="storageInfo">0 MB</div>
                        <div>×©×™××•×© ×‘××—×¡×•×Ÿ</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #34495e; border-radius: 8px; color: white; font-size: 0.9rem;" id="audioSupportInfo">
                    <strong>×‘×•×“×§ ×ª××™×›×ª ×“×¤×“×¤×Ÿ...</strong>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button class="admin-btn danger" onclick="resetAllData()" style="background: #e67e22;">
                        ğŸ”„ ××™×¤×•×¡ ×›×œ ×”× ×ª×•× ×™× (×™××¤×¡ ×”×›×œ!)
                    </button>
                    <button class="admin-btn" onclick="refreshPage()" style="background: #16a085;">
                        â™»ï¸ ×¨×¢× ×Ÿ ×“×£
                    </button>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: #f39c12; border-radius: 8px; color: white; font-size: 0.8rem;">
                    <strong>ğŸ› ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª ××•×“×™×•:</strong><br>
                    â€¢ ×œ×—×¦×• F12 ×œ×¤×ª×™×—×ª ×›×œ×™ ××¤×ª×— ×•×‘×“×§×• ××ª ×”×§×•× ×¡×•×œ<br>
                    â€¢ ×•×“××• ×©×¢×•×¦××ª ×”×§×•×œ ×‘××—×©×‘ ×’×‘×•×”×”<br>
                    â€¢ × ×¡×• ×§×•×‘×¥ MP3 ××™×›×•×ª×™ (×œ× ××¤×•×—×ª ××™×›×•×ª)<br>
                    â€¢ ×‘×“×§×• ×©×”×“×¤×“×¤×Ÿ ×ª×•××š ×‘×¤×•×¨××˜ ×”×§×•×‘×¥ ×œ××¢×œ×”<br>
                    â€¢ ×œ×—×¦×• ×¢×œ ×›×¤×ª×•×¨ ğŸ” ×‘× ×’×Ÿ ×œ×‘×“×™×§×ª ××•×“×™×•<br>
                    â€¢ ×œ×—×¦×• ×¢×œ ğŸ” ×œ×™×“ ×”×¡×™×¤×•×¨ ×‘××¡×š × ×™×”×•×œ ×œ×“×™×‘××’ ××¤×•×¨×˜
                </div>
            </div>
        </div>

    <!-- × ×™×•×•×˜ ×ª×—×ª×•×Ÿ -->
    <div class="bottom-nav">
        <button class="nav-btn" onclick="toggleAdmin()" title="×¤×× ×œ × ×™×”×•×œ">âš™ï¸</button>
        <button class="nav-btn" onclick="goHome()" title="×—×–×¨×” ×œ×¢××•×“ ×”×‘×™×ª">ğŸ </button>
    </div>

        <!-- ××¡×š ×”×ª×—×‘×¨×•×ª ×œ× ×™×”×•×œ -->
        <div class="admin-login" id="adminLogin">
            <div class="login-form">
                <h3>ğŸ” ×”×ª×—×‘×¨×•×ª ×œ××¡×š × ×™×”×•×œ</h3>
                <input type="password" class="login-input" id="adminPassword" placeholder="×”×›× ×™×¡×• ×¡×™×¡××”">
                <div id="loginError" style="color: #e74c3c; margin: 10px 0; display: none;">×¡×™×¡××” ×©×’×•×™×”</div>
                <button class="login-btn" onclick="checkPassword()">×”×ª×—×‘×¨</button>
                <button class="login-btn cancel" onclick="closeLogin()">×‘×™×˜×•×œ</button>
            </div>
        </div>
    </div>

    <!-- × ×™×•×•×˜ ×ª×—×ª×•×Ÿ -->
    <div class="bottom-nav">
        <button class="nav-btn" onclick="toggleAdmin()" title="×¤×× ×œ × ×™×”×•×œ">âš™ï¸</button>
        <button class="nav-btn" onclick="goHome()" title="×—×–×¨×” ×œ×¢××•×“ ×”×‘×™×ª">ğŸ </button>
    </div>

    <script>
        // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
        let stories = JSON.parse(localStorage.getItem('stories')) || [];
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let playStats = JSON.parse(localStorage.getItem('playStats')) || { totalPlays: 0 };
        let isPlaying = false;
        let currentAudio = null;
        let isAdminLoggedIn = false;
        const adminPassword = 'admin123'; // × ×™×ª×Ÿ ×œ×©× ×•×ª ××ª ×”×¡×™×¡××” ×›××Ÿ
        let filteredStories = [];

        // ×ª×¨×’×•××™×
        const translations = {
            he: {
                title: '××•×–×™××•×Ÿ ×”×¡×™×¤×•×¨×™×',
                subtitle: '×’×œ×• ××ª ×”×¡×™×¤×•×¨×™× ×”××¨×ª×§×™× ×©×œ ×ª×œ ××‘×™×‘',
                personal: '×”××–× ×” ××™×©×™×ª',
                personalDesc: '×‘×—×¨×• ×¡×™×¤×•×¨ ×•×”××–×™× ×• ×‘××•×–× ×™×•×ª ×”×¤×¨×˜×™×•×ª ×©×œ×›×',
                group: '×”××–× ×” ×§×‘×•×¦×ª×™×ª', 
                groupDesc: '×”×¦×˜×¨×¤×• ×œ×”××–× ×” ××©×•×ª×¤×ª ×‘×‘×¨ ×•×‘×©×•×œ×—× ×•×ª ×‘×™×ª ×”×§×¤×”',
                qr: '×¡×¨×™×§×ª QR',
                qrDesc: '×¡×¨×§×• ××ª ×”×§×•×“ ×‘×›×™×¡× ×”××™×©×™ ×•×”××–×™× ×• ×‘××•×–× ×™×•×ª ×©×œ×›×'
            },
            en: {
                title: 'Stories Museum',
                subtitle: 'Discover the fascinating stories of Tel Aviv',
                personal: 'Personal Listening',
                personalDesc: 'Choose a story and listen with your personal headphones',
                group: 'Group Listening',
                groupDesc: 'Join shared listening at the bar and cafe tables',
                qr: 'QR Scan',
                qrDesc: 'Scan the code on the personal chair and listen with your headphones'
            },
            ar: {
                title: 'Ù…ØªØ­Ù Ø§Ù„Ù‚ØµØµ',
                subtitle: 'Ø§ÙƒØªØ´Ù Ø§Ù„Ù‚ØµØµ Ø§Ù„Ø±Ø§Ø¦Ø¹Ø© Ù„ØªÙ„ Ø£Ø¨ÙŠØ¨',
                personal: 'Ø§Ø³ØªÙ…Ø§Ø¹ Ø´Ø®ØµÙŠ',
                personalDesc: 'Ø§Ø®ØªØ± Ù‚ØµØ© ÙˆØ§Ø³ØªÙ…Ø¹ Ø¨Ø³Ù…Ø§Ø¹Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©',
                group: 'Ø§Ø³ØªÙ…Ø§Ø¹ Ø¬Ù…Ø§Ø¹ÙŠ',
                groupDesc: 'Ø§Ù†Ø¶Ù… Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ù…Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø§Ø± ÙˆØ·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ù‚Ù‡Ù‰',
                qr: 'Ù…Ø³Ø­ QR',
                qrDesc: 'Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ±Ø³ÙŠ Ø§Ù„Ø´Ø®ØµÙŠ ÙˆØ§Ø³ØªÙ…Ø¹ Ø¨Ø³Ù…Ø§Ø¹Ø§ØªÙƒ'
            }
        };

        // ××ª×—×•×œ ×”××¤×œ×™×§×¦×™×”
        document.addEventListener('DOMContentLoaded', function() {
            // ××™×¤×•×¡ ××œ× ×©×œ ×”× ×ª×•× ×™× ×”×™×©× ×™× ×× ××™×Ÿ audioData
            const storedStories = JSON.parse(localStorage.getItem('stories')) || [];
            if (storedStories.length > 0 && !storedStories[0].hasOwnProperty('audioData')) {
                console.log('××¢×“×›×Ÿ ××‘× ×” × ×ª×•× ×™× ×™×©×Ÿ...');
                localStorage.removeItem('stories');
                stories = [];
            } else {
                stories = storedStories;
            }
            
            loadStoriesFromStorage();
            loadUsersFromStorage();
            updateStats();
            setupEventListeners();
            
            // ×”×•×¡×¤×ª ×××–×™×Ÿ ×œ×œ×—×™×¦×ª Enter ×‘××¡×š ×”×ª×—×‘×¨×•×ª
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });

            // ×”×’×“×¨×ª ×—×™×¤×•×©
            document.getElementById('searchInput').addEventListener('input', function() {
                searchStories(this.value);
            });

            // ×”×’×“×¨×ª ×¢×•×¦××ª ×§×•×œ ×”×ª×—×œ×ª×™×ª
            document.getElementById('volumeControl').value = 100;
            
            // ×”×•×¡×¤×ª ×¡×™×¤×•×¨×™× ×œ×“×•×’××” ×× ××™×Ÿ
            if (stories.length === 0) {
                addSampleStories();
            }

            // ××ª×—×•×œ ×¨×©×™××ª ×”×¡×™×¤×•×¨×™× ×”××¡×•× × ×™×
            filteredStories = stories;

            // ×”×¦×’×ª ×›×œ ×”×¡×™×¤×•×¨×™× ×‘×”×ª×—×œ×”
            displayStories();
        });

        // ×”×’×“×¨×ª ×××–×™× ×™× ×œ××™×¨×•×¢×™×
        function setupEventListeners() {
            // ×›××Ÿ × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×××–×™× ×™× × ×•×¡×¤×™× ×‘×¢×ª×™×“
        }

        // ×—×™×¤×•×© ×¡×™×¤×•×¨×™×
        function searchStories(searchTerm) {
            if (!searchTerm.trim()) {
                filteredStories = stories;
            } else {
                filteredStories = stories.filter(story => 
                    story.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    story.description.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            displayStories();
        }

        // ×”×©××¢×ª ×¡×™×¤×•×¨ ×¨× ×“×•××œ×™
        function playRandomStory() {
            const availableStories = filteredStories.length > 0 ? filteredStories : stories;
            if (availableStories.length === 0) {
                alert('××™×Ÿ ×¡×™×¤×•×¨×™× ×–××™× ×™×');
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * availableStories.length);
            const randomStory = availableStories[randomIndex];
            playStory(randomStory.id);
        }

        // ×”×¦×’×ª ×¡×™×¤×•×¨×™×
        function displayStories() {
            const grid = document.getElementById('storiesGrid');
            const storiesToShow = filteredStories.length > 0 || document.getElementById('searchInput').value ? 
                                  filteredStories : stories;
            
            grid.innerHTML = '';
            
            if (storiesToShow.length === 0) {
                grid.innerHTML = '<div style="text-align: center; color: #7f8c8d; grid-column: 1/-1;">×œ× × ××¦××• ×¡×™×¤×•×¨×™×</div>';
                return;
            }
            
            storiesToShow.forEach((story, index) => {
                const card = document.createElement('div');
                card.className = 'story-card';
                
                // ×”×•×¡×¤×ª ×ª×’ ×©×¤×”
                const languageTag = story.language === 'he' ? '×¢×‘×¨×™×ª' : 
                                   story.language === 'en' ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
                
                card.innerHTML = `
                    <div class="story-title">${story.title}</div>
                    <div class="story-description">${story.description}</div>
                    <div class="story-duration">â±ï¸ ${story.duration} ×“×§×•×ª | ğŸŒ ${languageTag}</div>
                    <button class="play-btn" onclick="playStory(${story.id})">â–¶ï¸ ×”××–× ×”</button>
                `;
                grid.appendChild(card);
            });
        }

        // × ×’×™× ×ª ×¡×™×¤×•×¨
        function playStory(storyId) {
            const story = stories.find(s => s.id === storyId);
            if (!story) return;

            // ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª
            playStats.totalPlays++;
            localStorage.setItem('playStats', JSON.stringify(playStats));
            updateStats();

            // ×”×¦×’×ª ×”× ×’×Ÿ
            document.getElementById('currentStoryTitle').textContent = story.title;
            document.getElementById('audioPlayer').style.display = 'block';
            
            // ×¡×™××•×œ×¦×™×” ×©×œ × ×’×™× ×”
            simulateAudioPlayback(story);
        }

        // ×¡×™××•×œ×¦×™×” ×©×œ × ×’×™× ×ª ××•×“×™×•
        function simulateAudioPlayback(story) {
            isPlaying = true;
            let progress = 0;
            const progressBar = document.getElementById('progressBar');
            
            const interval = setInterval(() => {
                if (!isPlaying) {
                    clearInterval(interval);
                    return;
                }
                
                progress += 1;
                progressBar.value = progress;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    isPlaying = false;
                    closePlayer();
                }
            }, (story.duration * 60 * 1000) / 100); // ××—×œ×§ ××ª ×”×–××Ÿ ×œ-100 ×—×œ×§×™×
        }

        // ×“×™×‘××’ ×¡×™×¤×•×¨
        function debugStory(storyId) {
            const story = stories.find(s => s.id === storyId);
            if (!story) {
                alert('×¡×™×¤×•×¨ ×œ× × ××¦×');
                return;
            }
            
            let debugInfo = `ğŸ“Š ××™×“×¢ ×¢×œ ×”×¡×™×¤×•×¨ "${story.title}":\n\n`;
            debugInfo += `ğŸ†” ID: ${story.id}\n`;
            debugInfo += `ğŸ“ ×ª×™××•×¨: ${story.description}\n`;
            debugInfo += `â±ï¸ ××©×š: ${story.duration} ×“×§×•×ª\n`;
            debugInfo += `ğŸŒ ×©×¤×”: ${story.language}\n`;
            debugInfo += `ğŸ“… × ×•×¦×¨: ${new Date(story.createdAt).toLocaleString('he-IL')}\n\n`;
            
            // ×‘×“×™×§×ª ×§×•×‘×¥ ××•×“×™×•
            debugInfo += `ğŸµ ××™×“×¢ ×¢×œ ××•×“×™×•:\n`;
            debugInfo += `ğŸ“ ×©× ×§×•×‘×¥: "${story.audioFile || '×œ×œ×'}"\n`;
            
            if (story.audioData) {
                debugInfo += `ğŸ“Š ×’×•×“×œ × ×ª×•× ×™×: ${Math.round(story.audioData.length / 1024)}KB\n`;
                debugInfo += `ğŸ”¢ ×ª×—×™×œ×ª × ×ª×•× ×™×: ${story.audioData.substring(0, 50)}...\n`;
                debugInfo += `âœ… ×¡×˜×˜×•×¡: × ×ª×•× ×™ ××•×“×™×• ×§×™×™××™×\n`;
                
                // ×‘×“×™×§×” ×× ×–×” Data URL ×ª×§×™×Ÿ
                if (story.audioData.startsWith('data:audio/')) {
                    debugInfo += `âœ… ×¤×•×¨××˜: Data URL ×ª×§×™×Ÿ\n`;
                } else {
                    debugInfo += `âŒ ×¤×•×¨××˜: Data URL ×œ× ×ª×§×™×Ÿ!\n`;
                }
            } else {
                debugInfo += `âŒ ××™×Ÿ × ×ª×•× ×™ ××•×“×™×•\n`;
            }
            
            alert(debugInfo);
        }

        // ×ª×™×§×•×Ÿ ×¡×™×¤×•×¨ ×¢× ××•×“×™×• ×©×‘×•×¨
        function fixStoryAudio(storyId) {
            const story = stories.find(s => s.id === storyId);
            if (!story) return;
            
            // ××™×¤×•×¡ × ×ª×•× ×™ ×”××•×“×™×• ×”×¤×’×•××™×
            story.audioData = '';
            story.audioFile = '';
            
            // ×©××™×¨×”
            localStorage.setItem('stories', JSON.stringify(stories));
            displayStoriesInAdmin();
            
            alert(`×”×¡×™×¤×•×¨ "${story.title}" ×ª×•×§×Ÿ. ×›×¢×ª ×ª×•×›×œ×• ×œ×”×¢×œ×•×ª ×§×•×‘×¥ ××•×“×™×• ×—×“×© ×¢×‘×•×¨×•.`);
        }
        function updateVolume() {
            const audioPlayer = document.getElementById('realAudioPlayer');
            const volumeControl = document.getElementById('volumeControl');
            const volume = volumeControl.value / 100;
            audioPlayer.volume = volume;
            
            // ×¢×“×›×•×Ÿ ××™×“×¢
            document.getElementById('audioDebug').innerHTML = `ğŸ”Š ×¢×•×¦××”: ${volumeControl.value}%`;
        }

        // ×‘×“×™×§×ª ××•×“×™×•
        function testAudio() {
            const audioPlayer = document.getElementById('realAudioPlayer');
            const debugDiv = document.getElementById('audioDebug');
            const statusDiv = document.getElementById('audioStatus');
            
            statusDiv.textContent = 'ğŸ” ××¨×™×¥ ×‘×“×™×§×ª ××•×“×™×•...';
            
            if (!audioPlayer.src || audioPlayer.src === '') {
                statusDiv.textContent = 'âŒ ××™×Ÿ ×§×•×‘×¥ ××•×“×™×• ×˜×¢×•×Ÿ';
                debugDiv.innerHTML = `
                    ğŸš¨ ×œ× × ××¦× ×§×•×‘×¥ ××•×“×™×•<br>
                    ğŸ’¡ ×”×•×¡×™×¤×• ×§×•×‘×¥ ××•×“×™×• ×‘×¢×¨×™×›×ª ×”×¡×™×¤×•×¨<br>
                    ğŸ”§ ××• ×œ×—×¦×• F12 ×•×‘×“×§×• ×©×’×™××•×ª ×‘×§×•× ×¡×•×œ
                `;
                return;
            }
            
            // ××™×“×¢ ×¢×œ ×”×§×•×‘×¥
            debugDiv.innerHTML = `
                ğŸ“ ××§×•×¨ ×§×™×™×: âœ…<br>
                ğŸ“Š ××•×›×Ÿ: ${audioPlayer.readyState}/4<br>
                ğŸ”Š ×¢×•×¦××”: ${Math.round(audioPlayer.volume * 100)}%<br>
                â±ï¸ ××©×š: ${audioPlayer.duration ? Math.round(audioPlayer.duration) + ' ×©× ×™×•×ª' : '×˜×•×¢×Ÿ...'}
            `;
            
            // × ×™×¡×™×•×Ÿ × ×’×™× ×”
            statusDiv.textContent = 'ğŸ” ×‘×•×“×§ ××•×“×™×•...';
            
            audioPlayer.play().then(() => {
                statusDiv.textContent = 'âœ… ×”××•×“×™×• ×¢×•×‘×“! ×××•×¨ ×œ×”×™×©××¢ ×¢×›×©×™×•';
                debugDiv.innerHTML += '<br>ğŸµ ×”×‘×“×™×§×” ×”×¦×œ×™×—×” - ×”××•×“×™×• ×ª×§×™×Ÿ';
                setTimeout(() => {
                    audioPlayer.pause();
                    audioPlayer.currentTime = 0;
                    statusDiv.textContent = 'âœ… ×‘×“×™×§×” ×”×•×©×œ××” - ×”××•×“×™×• ×ª×§×™×Ÿ';
                }, 2000);
            }).catch(error => {
                statusDiv.textContent = `âŒ ×©×’×™××”: ${error.message}`;
                debugDiv.innerHTML += `<br>ğŸš¨ ×©×’×™××”: ${error}<br>ğŸ’¡ × ×¡×• ×œ×˜×¢×•×Ÿ ×§×•×‘×¥ MP3 ××—×¨`;
                console.error('Test audio error:', error);
            });
        }
        function togglePlay() {
            const audioPlayer = document.getElementById('realAudioPlayer');
            
            // ×× ×™×© ××•×“×™×• ×××™×ª×™
            if (audioPlayer.src && audioPlayer.style.display !== 'none') {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                    isPlaying = true;
                } else {
                    audioPlayer.pause();
                    isPlaying = false;
                }
            } else {
                // ×¡×™××•×œ×¦×™×”
                isPlaying = !isPlaying;
            }
        }

        function closePlayer() {
            const audioPlayer = document.getElementById('realAudioPlayer');
            audioPlayer.pause();
            audioPlayer.src = '';
            audioPlayer.style.display = 'none';
            
            document.getElementById('simulationProgress').style.display = 'flex';
            document.getElementById('progressBar').value = 0;
            document.getElementById('audioStatus').textContent = '';
            document.getElementById('audioPlayer').style.display = 'none';
            isPlaying = false;
        }

        // × ×™×”×•×œ ×¡×™×¤×•×¨×™×
        function addStory() {
            const title = document.getElementById('storyTitle').value.trim();
            const description = document.getElementById('storyDescription').value.trim();
            const duration = document.getElementById('storyDuration').value;
            const language = document.getElementById('storyLanguage').value;
            const fileInput = document.getElementById('storyFile');
            
            if (!title || !description || !duration) {
                alert('×× × ××œ××• ××ª ×›×œ ×”×©×“×•×ª ×”×—×•×‘×” (×©×, ×ª×™××•×¨, ××©×š)');
                return;
            }
            
            if (duration < 1 || duration > 120) {
                alert('××©×š ×”×¡×™×¤×•×¨ ×—×™×™×‘ ×œ×”×™×•×ª ×‘×™×Ÿ 1 ×œ-120 ×“×§×•×ª');
                return;
            }
            
            // ×‘×“×™×§×” ×× ×™×© ×§×•×‘×¥ ××•×“×™×•
            if (fileInput.files && fileInput.files[0]) {
                const file = fileInput.files[0];
                
                // ×‘×“×™×§×” ×©×–×” ×§×•×‘×¥ ××•×“×™×•
                if (!file.type.startsWith('audio/')) {
                    alert('×× × ×‘×—×¨×• ×§×•×‘×¥ ××•×“×™×• ×ª×§×™×Ÿ');
                    return;
                }
                
                // ×‘×“×™×§×ª ×’×•×“×œ ×§×•×‘×¥ (××§×¡×™××•× 10MB)
                const maxSize = 10 * 1024 * 1024; // 10MB
                if (file.size > maxSize) {
                    alert('×§×•×‘×¥ ×”××•×“×™×• ×’×“×•×œ ××“×™. ×× × ×‘×—×¨×• ×§×•×‘×¥ ×§×˜×Ÿ ×-10MB');
                    return;
                }
                
                // ×”×•×“×¢×” ×¢×œ ×˜×¢×™× ×”
                const loadingMsg = document.createElement('div');
                loadingMsg.innerHTML = 'â³ ×˜×•×¢×Ÿ ×§×•×‘×¥ ××•×“×™×•... ×× × ×”××ª×™× ×•';
                loadingMsg.style.color = '#3498db';
                loadingMsg.style.marginTop = '10px';
                loadingMsg.style.fontWeight = 'bold';
                document.getElementById('storyFile').parentNode.appendChild(loadingMsg);
                
                // ×§×¨×™××ª ×”×§×•×‘×¥ ×•×”××¨×” ×œ-Data URL
                const reader = new FileReader();
                reader.onload = function(e) {
                    const audioData = e.target.result;
                    console.log('×§×•×‘×¥ × ×§×¨× ×‘×”×¦×œ×—×”:', {
                        fileName: file.name,
                        size: file.size,
                        type: file.type,
                        dataLength: audioData.length,
                        dataStart: audioData.substring(0, 50)
                    });
                    
                    // ×”×¡×¨×ª ×”×•×“×¢×ª ×”×˜×¢×™× ×”
                    if (loadingMsg.parentNode) {
                        loadingMsg.parentNode.removeChild(loadingMsg);
                    }
                    
                    saveStoryWithAudio(title, description, duration, language, file.name, audioData);
                };
                reader.onerror = function(error) {
                    console.error('×©×’×™××” ×‘×§×¨×™××ª ×§×•×‘×¥:', error);
                    
                    // ×”×¡×¨×ª ×”×•×“×¢×ª ×”×˜×¢×™× ×”
                    if (loadingMsg.parentNode) {
                        loadingMsg.parentNode.removeChild(loadingMsg);
                    }
                    
                    alert('×©×’×™××” ×‘×˜×¢×™× ×ª ×§×•×‘×¥ ×”××•×“×™×•: ' + error);
                };
                reader.onprogress = function(e) {
                    if (e.lengthComputable) {
                        const percent = Math.round((e.loaded / e.total) * 100);
                        loadingMsg.innerHTML = `â³ ×˜×•×¢×Ÿ ×§×•×‘×¥ ××•×“×™×•... ${percent}%`;
                    }
                };
                
                reader.readAsDataURL(file);
            } else {
                // ×©××™×¨×” ×œ×œ× ×§×•×‘×¥ ××•×“×™×•
                saveStoryWithAudio(title, description, duration, language, '', '');
            }
        }
        
        function saveStoryWithAudio(title, description, duration, language, fileName, audioData) {
            console.log('×©×•××¨ ×¡×™×¤×•×¨:', { title, fileName, hasAudio: !!audioData });
            
            const story = {
                id: Date.now(),
                title,
                description,
                duration: parseInt(duration),
                language,
                audioFile: fileName,
                audioData: audioData || '', // ×•×™×“×•× ×©×™×© ×¢×¨×š
                createdAt: new Date().toISOString()
            };
            
            // ×‘×“×™×§×” ×©×”× ×ª×•× ×™× ×ª×§×™× ×™× ×œ×¤× ×™ ×©××™×¨×”
            if (audioData && !audioData.startsWith('data:audio/')) {
                console.error('×©×’×™××”: × ×ª×•× ×™ ××•×“×™×• ×œ× ×ª×§×™× ×™×');
                alert('×©×’×™××” ×‘×©××™×¨×ª ×§×•×‘×¥ ×”××•×“×™×•. × ×¡×• ×©×•×‘ ×¢× ×§×•×‘×¥ ××—×¨.');
                return;
            }
            
            stories.push(story);
            
            try {
                localStorage.setItem('stories', JSON.stringify(stories));
                console.log('×”×¡×™×¤×•×¨ × ×©××¨ ×‘×”×¦×œ×—×”');
            } catch (error) {
                console.error('×©×’×™××” ×‘×©××™×¨×”:', error);
                alert('×©×’×™××” ×‘×©××™×¨×ª ×”×¡×™×¤×•×¨. ×”×§×•×‘×¥ ×¢×œ×•×œ ×œ×”×™×•×ª ×’×“×•×œ ××“×™.');
                // ×”×¡×¨×ª ×”×¡×™×¤×•×¨ ××”×¨×©×™××” ×× ×”×©××™×¨×” × ×›×©×œ×”
                stories.pop();
                return;
            }
            
            // ×¢×“×›×•×Ÿ ×”×¨×©×™××” ×”××¡×•× × ×ª
            filteredStories = stories;
            
            // ××™×¤×•×¡ ×”×˜×•×¤×¡
            document.getElementById('storyTitle').value = '';
            document.getElementById('storyDescription').value = '';
            document.getElementById('storyDuration').value = '';
            document.getElementById('storyFile').value = '';
            
            displayStoriesInAdmin();
            displayStories();
            updateStats();
            
            if (audioData) {
                const audioSize = Math.round(audioData.length / 1024);
                alert(`âœ… ×¡×™×¤×•×¨ "${title}" × ×•×¡×£ ×‘×”×¦×œ×—×” ×¢× ×§×•×‘×¥ ××•×“×™×•! ğŸµ\n×’×•×“×œ: ${audioSize}KB`);
            } else {
                alert(`âœ… ×¡×™×¤×•×¨ "${title}" × ×•×¡×£ ×‘×”×¦×œ×—×”! (×œ×œ× ××•×“×™×•)`);
            }
        }

        function deleteStory(id) {
            if (confirm('×”×× ××ª× ×‘×˜×•×—×™× ×©×‘×¨×¦×•× ×›× ×œ××—×•×§ ××ª ×”×¡×™×¤×•×¨?')) {
                stories = stories.filter(s => s.id !== id);
                localStorage.setItem('stories', JSON.stringify(stories));
                
                // ×¢×“×›×•×Ÿ ×”×¨×©×™××” ×”××¡×•× × ×ª
                filteredStories = filteredStories.filter(s => s.id !== id);
                
                displayStoriesInAdmin();
                displayStories();
                updateStats();
            }
        }

        function displayStoriesInAdmin() {
            const list = document.getElementById('storyList');
            list.innerHTML = '';
            
            if (stories.length === 0) {
                list.innerHTML = '<div style="text-align: center; color: #7f8c8d; padding: 20px;">××™×Ÿ ×¡×™×¤×•×¨×™× ×¢×“×™×™×Ÿ</div>';
                return;
            }
            
            stories.forEach(story => {
                const item = document.createElement('div');
                item.className = 'story-item';
                
                // ×‘×“×™×§×” ××¤×•×¨×˜×ª ×©×œ ××•×“×™×•
                let audioInfo;
                let audioDebugInfo = '';
                
                if (story.audioData && story.audioData.length > 0) {
                    const audioSize = Math.round(story.audioData.length / 1024);
                    audioInfo = `ğŸµ ${story.audioFile} (${audioSize}KB)`;
                    audioDebugInfo = `âœ… ×™×© × ×ª×•× ×™ ××•×“×™×•`;
                } else if (story.audioFile && story.audioFile.length > 0) {
                    audioInfo = `âŒ ${story.audioFile} (×§×•×‘×¥ ×œ× × ×©××¨)`;
                    audioDebugInfo = `âš ï¸ ×™×© ×©× ×§×•×‘×¥ ××‘×œ ×œ× × ×ª×•× ×™×`;
                } else {
                    audioInfo = 'ğŸ”‡ ×œ×œ× ×§×•×‘×¥ ××•×“×™×•';
                    audioDebugInfo = `â„¹ï¸ ×œ× ×”×•×¢×œ×” ×§×•×‘×¥`;
                }
                
                const languageTag = story.language === 'he' ? '×¢×‘×¨×™×ª' : 
                                   story.language === 'en' ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
                
                item.innerHTML = `
                    <div>
                        <strong>${story.title}</strong> (${languageTag})<br>
                        <small>${story.description}</small><br>
                        <small style="color: #3498db;">â±ï¸ ${story.duration} ×“×§×•×ª | ${audioInfo}</small><br>
                        <small style="color: #95a5a6;">${audioDebugInfo}</small>
                    </div>
                    <div style="display: flex; gap: 5px; flex-direction: column;">
                        <button class="admin-btn danger" onclick="deleteStory(${story.id})" style="font-size: 0.8rem;">ğŸ—‘ï¸ ××—×§</button>
                        <button class="admin-btn" onclick="debugStory(${story.id})" style="font-size: 0.8rem; background: #f39c12;">ğŸ” ×“×™×‘××’</button>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // × ×™×”×•×œ ××©×ª××©×™×
        function addUser() {
            const name = document.getElementById('userName').value;
            const phone = document.getElementById('userPhone').value;
            const language = document.getElementById('userLanguage').value;
            
            if (!name || !phone) {
                alert('×× × ××œ××• ××ª ×›×œ ×”×©×“×•×ª');
                return;
            }
            
            const user = {
                id: Date.now(),
                name,
                phone,
                language,
                preferences: {},
                createdAt: new Date().toISOString()
            };
            
            users.push(user);
            localStorage.setItem('users', JSON.stringify(users));
            
            // ××™×¤×•×¡ ×”×˜×•×¤×¡
            document.getElementById('userName').value = '';
            document.getElementById('userPhone').value = '';
            
            displayUsersInAdmin();
            updateStats();
        }

        function deleteUser(id) {
            if (confirm('×”×× ××ª× ×‘×˜×•×—×™× ×©×‘×¨×¦×•× ×›× ×œ××—×•×§ ××ª ×”××©×ª××©?')) {
                users = users.filter(u => u.id !== id);
                localStorage.setItem('users', JSON.stringify(users));
                displayUsersInAdmin();
                updateStats();
            }
        }

        function displayUsersInAdmin() {
            const list = document.getElementById('userList');
            list.innerHTML = '';
            
            users.forEach(user => {
                const item = document.createElement('div');
                item.className = 'user-item';
                item.innerHTML = `
                    <div>
                        <strong>${user.name}</strong><br>
                        <small>${user.phone} - ${user.language}</small>
                    </div>
                    <button class="admin-btn danger" onclick="deleteUser(${user.id})">ğŸ—‘ï¸ ××—×§</button>
                `;
                list.appendChild(item);
            });
        }

        function exportUsers() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(users, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "users.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        // ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª
        function updateStats() {
            document.getElementById('totalStories').textContent = stories.length;
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalPlays').textContent = playStats.totalPlays;
            
            // ×‘×“×™×§×ª ×’×•×“×œ ××—×¡×•×Ÿ
            const storageUsed = JSON.stringify(stories).length;
            const storageUsedMB = (storageUsed / (1024 * 1024)).toFixed(2);
            
            // ×”×•×¡×¤×ª ××™×“×¢ ×¢×œ ×”×©×™××•×© ×‘××—×¡×•×Ÿ
            const storageInfo = document.getElementById('storageInfo');
            if (storageInfo) {
                storageInfo.textContent = `${storageUsedMB} MB`;
            }

            // ××™×“×¢ ×¢×œ ×ª××™×›×” ×‘××•×“×™×•
            const audioSupport = document.getElementById('audioSupportInfo');
            if (audioSupport) {
                const audio = document.createElement('audio');
                const mp3Support = audio.canPlayType('audio/mpeg');
                const wavSupport = audio.canPlayType('audio/wav');
                const oggSupport = audio.canPlayType('audio/ogg');
                
                audioSupport.innerHTML = `
                    <strong>×ª××™×›×ª ×“×¤×“×¤×Ÿ ×‘××•×“×™×•:</strong><br>
                    MP3: ${mp3Support ? 'âœ…' : 'âŒ'} | 
                    WAV: ${wavSupport ? 'âœ…' : 'âŒ'} | 
                    OGG: ${oggSupport ? 'âœ…' : 'âŒ'}<br>
                    ×“×¤×“×¤×Ÿ: ${navigator.userAgent.split(' ')[0]}
                `;
            }
        }

        // ×˜×¢×™× ×ª × ×ª×•× ×™× ××”××—×¡×•×Ÿ ×”××§×•××™
        function loadStoriesFromStorage() {
            displayStoriesInAdmin();
        }

        function loadUsersFromStorage() {
            displayUsersInAdmin();
        }

        // ×”×•×¡×¤×ª ×¡×™×¤×•×¨×™× ×œ×“×•×’××”
        function addSampleStories() {
            const sampleStories = [
                {
                    id: 1,
                    title: '×¡×™×¤×•×¨ ×©×•×§ ×”×›×¨××œ',
                    description: '×”×¡×™×¤×•×¨ ×”×§×¡×•× ×××—×•×¨×™ ×”×©×•×§ ×”×¦×‘×¢×•× ×™ ×‘×™×•×ª×¨ ×‘×ª×œ ××‘×™×‘',
                    duration: 8,
                    language: 'he',
                    audioFile: 'carmel-market-he.mp3',
                    audioData: '', // ×—×©×•×‘ ×œ××‘× ×” ×”×—×“×©
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    title: '× ×—×œ×ª ×‘× ×™××™×Ÿ',
                    description: '××¡×¢ ×‘×–××Ÿ ×‘×¨×—×•×‘ ×”××× ×™× ×”×§×¡×•×',
                    duration: 12,
                    language: 'he',
                    audioFile: 'carmel-market-he.mp3',
                    audioData: '', // ×—×©×•×‘ ×œ××‘× ×” ×”×—×“×©
                    createdAt: new Date().toISOString()
                },
                {
                    id: 3,
                    title: 'The Carmel Market Story',
                    description: 'The magical story behind Tel Aviv\'s most colorful market',
                    duration: 8,
                    language: 'en',
                    audioFile: 'carmel-market-he.mp3',
                    audioData: '', // ×—×©×•×‘ ×œ××‘× ×” ×”×—×“×©
                    createdAt: new Date().toISOString()
                },
                {
                    id: 4,
                    title: 'Ù‚ØµØ© Ø³ÙˆÙ‚ Ø§Ù„ÙƒØ±Ù…Ù„',
                    description: 'Ø§Ù„Ù‚ØµØ© Ø§Ù„Ø³Ø­Ø±ÙŠØ© ÙˆØ±Ø§Ø¡ Ø£ÙƒØ«Ø± Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ ØªÙ„ÙˆÙ†Ù‹Ø§ ÙÙŠ ØªÙ„ Ø£Ø¨ÙŠØ¨',
                    duration: 8,
                    language: 'ar',
                    audioFile: '',
                    audioData: '', // ×—×©×•×‘ ×œ××‘× ×” ×”×—×“×©
                    createdAt: new Date().toISOString()
                }
            ];
            
            stories = sampleStories;
            localStorage.setItem('stories', JSON.stringify(stories));
            
            // ×¢×“×›×•×Ÿ ×”×¨×©×™××” ×”××¡×•× × ×ª
            filteredStories = stories;
            
            displayStoriesInAdmin();
            updateStats();
        }

        // × ×™×”×•×œ ×”×ª×—×‘×¨×•×ª ×œ××¡×š × ×™×”×•×œ
        function toggleAdmin() {
            if (isAdminLoggedIn) {
                const panel = document.getElementById('adminPanel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            } else {
                const loginScreen = document.getElementById('adminLogin');
                loginScreen.style.display = 'flex';
                document.getElementById('adminPassword').focus();
            }
        }

        function checkPassword() {
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            if (password === adminPassword) {
                isAdminLoggedIn = true;
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('adminPassword').value = '';
                errorDiv.style.display = 'none';
            } else {
                errorDiv.style.display = 'block';
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        }

        function closeLogin() {
            document.getElementById('adminLogin').style.display = 'none';
            document.getElementById('adminPassword').value = '';
            document.getElementById('loginError').style.display = 'none';
        }

        // ××¤×©×¨×•×ª ×œ×”×•×¡×™×£ Enter ×œ××¡×š ×”×ª×—×‘×¨×•×ª
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });
        });

        // ××™×¤×•×¡ ×›×œ ×”× ×ª×•× ×™×
        function resetAllData() {
            if (confirm('×”×× ××ª× ×‘×˜×•×—×™× ×©×‘×¨×¦×•× ×›× ×œ××—×•×§ ××ª ×›×œ ×”× ×ª×•× ×™×?\n×¤×¢×•×œ×” ×–×• ×ª××—×§ ××ª ×›×œ ×”×¡×™×¤×•×¨×™×, ×”××©×ª××©×™× ×•×”×¡×˜×˜×™×¡×˜×™×§×•×ª!')) {
                if (confirm('×¤×¢×•×œ×” ×–×• ×‘×œ×ª×™ ×”×¤×™×›×”! ×”×× ××ª× ×‘×˜×•×—×™× ×œ×—×œ×•×˜×™×Ÿ?')) {
                    localStorage.clear();
                    alert('×›×œ ×”× ×ª×•× ×™× × ××—×§×•. ×”×“×£ ×™×ª×¨×¢× ×Ÿ ×›×¢×ª.');
                    location.reload();
                }
            }
        }

        function refreshPage() {
            location.reload();
        }

        // × ×™×•×•×˜
        function goHome() {
            // ××™×¤×•×¡ ×—×™×¤×•×© ×•×—×–×¨×” ×œ×¢××•×“ ×”×¨××©×™
            document.getElementById('searchInput').value = '';
            filteredStories = [];
            displayStories();
            document.getElementById('audioPlayer').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('adminLogin').style.display = 'none';
            isPlaying = false;
            isAdminLoggedIn = false; // ×”×ª× ×ª×§×•×ª ××”× ×™×”×•×œ
        }
    </script>
</body>
</html>
